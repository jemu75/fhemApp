{"version":3,"file":"stack.mjs","names":["getOverlapGroupHandler","getVisuals","hasOverlap","getNormalizedRange","getTimestampIdentifier","FULL_WIDTH","DEFAULT_OFFSET","WIDTH_MULTIPLIER","stack","events","firstWeekday","overlapThreshold","handler","day","dayEvents","timed","reset","dayStart","visuals","groups","getGroups","group","nodes","visual","child","getNode","index","getNextIndex","parent","getParent","sibling","start","end","addTime","children","push","getOverlappingRange","length","grand","grandNext","calculateBounds","sort","a","b","left","event","startTimestampIdentifier","node","columns","getMaxChildIndex","spaceLeft","spaceWidth","offset","Math","min","columnWidthMultiplier","getColumnWidthMultiplier","columnOffset","columnWidth","width","hasFullWidth","maxColumn","minColumn","reduce","c","getOverlappingIndices","indices","other","i","indexMin","indexMax","returnFirstColumn","arguments","undefined","overlapping","first","n","filter","added","max","childMax","identifier","minutes","removeMinutes","totalMinutes","addHours","floor","addMinutes"],"sources":["../../../../src/components/VCalendar/modes/stack.ts"],"sourcesContent":["// @ts-nocheck\n/* eslint-disable */\n\nimport { CalendarEventOverlapMode, CalendarEventVisual } from 'vuetify/types'\nimport { getOverlapGroupHandler, getVisuals, hasOverlap, getNormalizedRange } from './common'\nimport { getTimestampIdentifier } from '../util/timestamp'\n\ninterface Group {\n  start: number\n  end: number\n  visuals: CalendarEventVisual[]\n}\n\ninterface Node {\n  parent: Node | null\n  sibling: boolean\n  index: number\n  visual: CalendarEventVisual\n  start: number\n  end: number\n  children: Node[]\n}\n\nconst FULL_WIDTH = 100\n\nconst DEFAULT_OFFSET = 5\n\nconst WIDTH_MULTIPLIER = 1.7\n\n/**\n * Variation of column mode where events can be stacked. The priority of this\n * mode is to stack events together taking up the least amount of space while\n * trying to ensure the content of the event is always visible as well as its\n * start and end. A sibling column has intersecting event content and must be\n * placed beside each other. Non-sibling columns are offset by 5% from the\n * previous column. The width is scaled by 1.7 so the events overlap and\n * whitespace is reduced. If there is a hole in columns the event width is\n * scaled up so it intersects with the next column. The columns have equal\n * width in the space they are given. If the event doesn't have any to the\n * right of it that intersect with it's content it's right side is extended\n * to the right side.\n */\n\nexport const stack: CalendarEventOverlapMode = (events, firstWeekday, overlapThreshold) => {\n  const handler = getOverlapGroupHandler(firstWeekday)\n\n  // eslint-disable-next-line max-statements\n  return (day, dayEvents, timed, reset) => {\n    if (!timed) {\n      return handler.getVisuals(day, dayEvents, timed, reset)\n    }\n\n    const dayStart = getTimestampIdentifier(day)\n    const visuals = getVisuals(dayEvents, dayStart)\n    const groups = getGroups(visuals, dayStart)\n\n    for (const group of groups) {\n      const nodes: Node[] = []\n\n      for (const visual of group.visuals) {\n        const child = getNode(visual, dayStart)\n        const index = getNextIndex(child, nodes)\n\n        if (index === false) {\n          const parent = getParent(child, nodes)\n          if (parent) {\n            child.parent = parent\n            child.sibling = hasOverlap(child.start, child.end, parent.start, addTime(parent.start, overlapThreshold))\n            child.index = parent.index + 1\n            parent.children.push(child)\n          }\n        } else {\n          const [parent] = getOverlappingRange(child, nodes, index - 1, index - 1)\n          const children = getOverlappingRange(child, nodes, index + 1, index + nodes.length, true)\n\n          child.children = children\n          child.index = index\n\n          if (parent) {\n            child.parent = parent\n            child.sibling = hasOverlap(child.start, child.end, parent.start, addTime(parent.start, overlapThreshold))\n            parent.children.push(child)\n          }\n\n          for (const grand of children) {\n            if (grand.parent === parent) {\n              grand.parent = child\n            }\n\n            const grandNext = grand.index - child.index <= 1\n            if (grandNext && child.sibling &&\n              hasOverlap(child.start, addTime(child.start, overlapThreshold), grand.start, grand.end)) {\n              grand.sibling = true\n            }\n          }\n        }\n\n        nodes.push(child)\n      }\n\n      calculateBounds(nodes, overlapThreshold)\n    }\n\n    visuals.sort((a, b) => (a.left - b.left) || (a.event.startTimestampIdentifier - b.event.startTimestampIdentifier))\n\n    return visuals\n  }\n}\n\nfunction calculateBounds (nodes: Node[], overlapThreshold: number) {\n  for (const node of nodes) {\n    const { visual, parent } = node\n    const columns = getMaxChildIndex(node) + 1\n    const spaceLeft = parent ? parent.visual.left : 0\n    const spaceWidth = FULL_WIDTH - spaceLeft\n    const offset = Math.min(DEFAULT_OFFSET, FULL_WIDTH / columns)\n    const columnWidthMultiplier = getColumnWidthMultiplier(node, nodes)\n    const columnOffset = spaceWidth / (columns - node.index + 1)\n    const columnWidth = spaceWidth / (columns - node.index + (node.sibling ? 1 : 0)) * columnWidthMultiplier\n\n    if (parent) {\n      visual.left = node.sibling\n        ? spaceLeft + columnOffset\n        : spaceLeft + offset\n    }\n\n    visual.width = hasFullWidth(node, nodes, overlapThreshold)\n      ? FULL_WIDTH - visual.left\n      : Math.min(FULL_WIDTH - visual.left, columnWidth * WIDTH_MULTIPLIER)\n  }\n}\n\nfunction getColumnWidthMultiplier (node: Node, nodes: Node[]): number {\n  if (!node.children.length) {\n    return 1\n  }\n\n  const maxColumn = node.index + nodes.length\n  const minColumn = node.children.reduce((min, c) => Math.min(min, c.index), maxColumn)\n\n  return minColumn - node.index\n}\n\nfunction getOverlappingIndices (node: Node, nodes: Node[]): number[] {\n  const indices: number[] = []\n  for (const other of nodes) {\n    if (hasOverlap(node.start, node.end, other.start, other.end)) {\n      indices.push(other.index)\n    }\n  }\n  return indices\n}\n\nfunction getNextIndex (node: Node, nodes: Node[]): number | false {\n  const indices = getOverlappingIndices(node, nodes)\n  indices.sort()\n\n  for (let i = 0; i < indices.length; i++) {\n    if (i < indices[i]) {\n      return i\n    }\n  }\n  return false\n}\n\nfunction getOverlappingRange (node: Node, nodes: Node[], indexMin: number, indexMax: number, returnFirstColumn = false): Node[] {\n  const overlapping: Node[] = []\n  for (const other of nodes) {\n    if (other.index >= indexMin && other.index <= indexMax && hasOverlap(node.start, node.end, other.start, other.end)) {\n      overlapping.push(other)\n    }\n  }\n  if (returnFirstColumn && overlapping.length > 0) {\n    const first = overlapping.reduce((min, n) => Math.min(min, n.index), overlapping[0].index)\n    return overlapping.filter(n => n.index === first)\n  }\n  return overlapping\n}\n\nfunction getParent (node: Node, nodes: Node[]): Node | null {\n  let parent: Node | null = null\n  for (const other of nodes) {\n    if (hasOverlap(node.start, node.end, other.start, other.end) && (parent === null || other.index > parent.index)) {\n      parent = other\n    }\n  }\n  return parent\n}\n\nfunction hasFullWidth (node: Node, nodes: Node[], overlapThreshold: number): boolean {\n  for (const other of nodes) {\n    if (other !== node &&\n      other.index > node.index &&\n      hasOverlap(node.start, addTime(node.start, overlapThreshold), other.start, other.end)) {\n      return false\n    }\n  }\n\n  return true\n}\n\nfunction getGroups (visuals: CalendarEventVisual[], dayStart: number): Group[] {\n  const groups: Group[] = []\n\n  for (const visual of visuals) {\n    const [start, end] = getNormalizedRange(visual.event, dayStart)\n    let added = false\n\n    for (const group of groups) {\n      if (hasOverlap(start, end, group.start, group.end)) {\n        group.visuals.push(visual)\n        group.end = Math.max(group.end, end)\n        added = true\n        break\n      }\n    }\n\n    if (!added) {\n      groups.push({ start, end, visuals: [visual] })\n    }\n  }\n\n  return groups\n}\n\nfunction getNode (visual: CalendarEventVisual, dayStart: number): Node {\n  const [start, end] = getNormalizedRange(visual.event, dayStart)\n\n  return {\n    parent: null,\n    sibling: true,\n    index: 0,\n    visual,\n    start,\n    end,\n    children: [],\n  }\n}\n\nfunction getMaxChildIndex (node: Node): number {\n  let max = node.index\n  for (const child of node.children) {\n    const childMax = getMaxChildIndex(child)\n    if (childMax > max) {\n      max = childMax\n    }\n  }\n  return max\n}\n\nfunction addTime (identifier: number, minutes: number): number {\n  const removeMinutes = identifier % 100\n  const totalMinutes = removeMinutes + minutes\n  const addHours = Math.floor(totalMinutes / 60)\n  const addMinutes = totalMinutes % 60\n\n  return identifier - removeMinutes + addHours * 100 + addMinutes\n}\n"],"mappings":"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"}