{"version":3,"file":"headers.mjs","names":["capitalize","inject","provide","ref","watchEffect","consoleError","propsFactory","makeDataTableHeaderProps","headers","Array","VDataTableHeadersSymbol","Symbol","for","defaultHeader","title","sortable","defaultActionHeader","width","priorityQueue","arr","arguments","length","undefined","queue","map","element","priority","enqueue","added","i","item","splice","push","size","count","whole","Math","floor","dequeue","shift","extractLeaves","columns","children","child","extractKeys","keys","Set","key","add","getDefaultItem","includes","getDepth","depth","max","parseFixedColumns","items","seenFixed","setFixed","parentFixed","fixed","lastFixed","isNaN","setFixedOffset","fixedOffset","parseFloat","parse","maxDepth","currentDepth","rowSize","row","fraction","diff","rowspan","colspan","sort","pow","flat","convertToInternalHeaders","internalHeaders","defaultItem","value","internalItem","createHeaders","props","options","sortFunctions","filterFunctions","_headers","Object","slice","groupBy","has","unshift","showSelect","showExpand","parsed","flatHeaders","reduce","acc","header","filter","data","useHeaders","Error"],"sources":["../../../../src/components/VDataTable/composables/headers.ts"],"sourcesContent":["// Utilities\nimport { capitalize, inject, provide, ref, watchEffect } from 'vue'\nimport { consoleError, propsFactory } from '@/util'\n\n// Types\nimport type { DeepReadonly, InjectionKey, PropType, Ref } from 'vue'\nimport type { SortItem } from './sort'\nimport type { DataTableCompareFunction, DataTableHeader, InternalDataTableHeader } from '../types'\nimport type { FilterKeyFunctions } from '@/composables/filter'\n\nexport const makeDataTableHeaderProps = propsFactory({\n  headers: Array as PropType<DeepReadonly<DataTableHeader[]>>,\n}, 'DataTable-header')\n\nexport const VDataTableHeadersSymbol: InjectionKey<{\n  headers: Ref<InternalDataTableHeader[][]>\n  columns: Ref<InternalDataTableHeader[]>\n}> = Symbol.for('vuetify:data-table-headers')\n\ntype HeaderProps = {\n  headers: DeepReadonly<DataTableHeader[]> | undefined\n  items: any[]\n}\n\nconst defaultHeader = { title: '', sortable: false }\nconst defaultActionHeader = { ...defaultHeader, width: 48 }\n\nfunction priorityQueue <T> (arr: T[] = []) {\n  const queue: { element: T, priority: number }[] = arr.map(element => ({ element, priority: 0 }))\n\n  return {\n    enqueue: (element: T, priority: number) => {\n      let added = false\n      for (let i = 0; i < queue.length; i++) {\n        const item = queue[i]\n        if (item.priority > priority) {\n          queue.splice(i, 0, { element, priority })\n          added = true\n          break\n        }\n      }\n\n      if (!added) queue.push({ element, priority })\n    },\n    size: () => queue.length,\n    count: () => {\n      let count = 0\n\n      if (!queue.length) return 0\n\n      const whole = Math.floor(queue[0].priority)\n      for (let i = 0; i < queue.length; i++) {\n        if (Math.floor(queue[i].priority) === whole) count += 1\n      }\n\n      return count\n    },\n    dequeue: () => {\n      return queue.shift()\n    },\n  }\n}\n\nfunction extractLeaves (item: InternalDataTableHeader, columns: InternalDataTableHeader[] = []) {\n  if (!item.children) {\n    columns.push(item)\n  } else {\n    for (const child of item.children) {\n      extractLeaves(child, columns)\n    }\n  }\n\n  return columns\n}\n\nfunction extractKeys (headers: DeepReadonly<DataTableHeader[]>, keys = new Set<string>()) {\n  for (const item of headers) {\n    if (item.key) keys.add(item.key)\n\n    if (item.children) {\n      extractKeys(item.children, keys)\n    }\n  }\n\n  return keys\n}\n\nfunction getDefaultItem (item: DeepReadonly<DataTableHeader>) {\n  if (!item.key) return undefined\n  if (item.key === 'data-table-group') return defaultHeader\n  if (['data-table-expand', 'data-table-select'].includes(item.key)) return defaultActionHeader\n  return undefined\n}\n\nfunction getDepth (item: InternalDataTableHeader, depth = 0): number {\n  if (!item.children) return depth\n\n  return Math.max(depth, ...item.children.map(child => getDepth(child, depth + 1)))\n}\n\nfunction parseFixedColumns (items: InternalDataTableHeader[]) {\n  let seenFixed = false\n  function setFixed (item: InternalDataTableHeader, parentFixed = false) {\n    if (!item) return\n\n    if (parentFixed) {\n      item.fixed = true\n    }\n\n    if (item.fixed) {\n      if (item.children) {\n        for (let i = item.children.length - 1; i >= 0; i--) {\n          setFixed(item.children[i], true)\n        }\n      } else {\n        if (!seenFixed) {\n          item.lastFixed = true\n        } else if (isNaN(+item.width!)) {\n          consoleError(`Multiple fixed columns should have a static width (key: ${item.key})`)\n        }\n        seenFixed = true\n      }\n    } else {\n      if (item.children) {\n        for (let i = item.children.length - 1; i >= 0; i--) {\n          setFixed(item.children[i])\n        }\n      } else {\n        seenFixed = false\n      }\n    }\n  }\n\n  for (let i = items.length - 1; i >= 0; i--) {\n    setFixed(items[i])\n  }\n\n  function setFixedOffset (item: InternalDataTableHeader, fixedOffset = 0) {\n    if (!item) return fixedOffset\n\n    if (item.children) {\n      item.fixedOffset = fixedOffset\n      for (const child of item.children) {\n        fixedOffset = setFixedOffset(child, fixedOffset)\n      }\n    } else if (item.fixed) {\n      item.fixedOffset = fixedOffset\n      fixedOffset += parseFloat(item.width || '0') || 0\n    }\n\n    return fixedOffset\n  }\n\n  let fixedOffset = 0\n  for (const item of items) {\n    fixedOffset = setFixedOffset(item, fixedOffset)\n  }\n}\n\nfunction parse (items: InternalDataTableHeader[], maxDepth: number) {\n  const headers: InternalDataTableHeader[][] = []\n  let currentDepth = 0\n  const queue = priorityQueue(items)\n\n  while (queue.size() > 0) {\n    let rowSize = queue.count()\n    const row: InternalDataTableHeader[] = []\n    let fraction = 1\n    while (rowSize > 0) {\n      const { element: item, priority } = queue.dequeue()!\n      const diff = maxDepth - currentDepth - getDepth(item)\n\n      row.push({\n        ...item,\n        rowspan: diff ?? 1,\n        colspan: item.children ? extractLeaves(item).length : 1,\n      })\n\n      if (item.children) {\n        for (const child of item.children) {\n          // This internally sorts items that are on the same priority \"row\"\n          const sort = priority % 1 + (fraction / Math.pow(10, currentDepth + 2))\n          queue.enqueue(child, currentDepth + diff + sort)\n        }\n      }\n\n      fraction += 1\n      rowSize -= 1\n    }\n    currentDepth += 1\n    headers.push(row)\n  }\n\n  const columns = items.map(item => extractLeaves(item)).flat()\n\n  return { columns, headers }\n}\n\nfunction convertToInternalHeaders (items: DeepReadonly<DataTableHeader[]>) {\n  const internalHeaders: InternalDataTableHeader[] = []\n  for (const item of items) {\n    const defaultItem = { ...getDefaultItem(item), ...item }\n    const key = defaultItem.key ?? (typeof defaultItem.value === 'string' ? defaultItem.value : null)\n    const value = defaultItem.value ?? key ?? null\n    const internalItem: InternalDataTableHeader = {\n      ...defaultItem,\n      key,\n      value,\n      sortable: defaultItem.sortable ?? (defaultItem.key != null || !!defaultItem.sort),\n      children: defaultItem.children ? convertToInternalHeaders(defaultItem.children) : undefined,\n    }\n\n    internalHeaders.push(internalItem)\n  }\n\n  return internalHeaders\n}\n\nexport function createHeaders (\n  props: HeaderProps,\n  options?: {\n    groupBy?: Ref<readonly SortItem[]>\n    showSelect?: Ref<boolean>\n    showExpand?: Ref<boolean>\n  }\n) {\n  const headers = ref<InternalDataTableHeader[][]>([])\n  const columns = ref<InternalDataTableHeader[]>([])\n  const sortFunctions = ref<Record<string, DataTableCompareFunction>>()\n  const filterFunctions = ref<FilterKeyFunctions>()\n\n  watchEffect(() => {\n    const _headers = props.headers ||\n      Object.keys(props.items[0] ?? {}).map(key => ({ key, title: capitalize(key) })) as never\n\n    const items = _headers.slice()\n    const keys = extractKeys(items)\n\n    if (options?.groupBy?.value.length && !keys.has('data-table-group')) {\n      items.unshift({ key: 'data-table-group', title: 'Group' })\n    }\n\n    if (options?.showSelect?.value && !keys.has('data-table-select')) {\n      items.unshift({ key: 'data-table-select' })\n    }\n\n    if (options?.showExpand?.value && !keys.has('data-table-expand')) {\n      items.push({ key: 'data-table-expand' })\n    }\n\n    const internalHeaders = convertToInternalHeaders(items)\n\n    parseFixedColumns(internalHeaders)\n\n    const maxDepth = Math.max(...internalHeaders.map(item => getDepth(item))) + 1\n    const parsed = parse(internalHeaders, maxDepth)\n\n    headers.value = parsed.headers\n    columns.value = parsed.columns\n\n    const flatHeaders = parsed.headers.flat(1)\n\n    sortFunctions.value = flatHeaders.reduce((acc, header) => {\n      if (header.sortable && header.key && header.sort) {\n        acc[header.key] = header.sort\n      }\n      return acc\n    }, {} as Record<string, DataTableCompareFunction>)\n\n    filterFunctions.value = flatHeaders.reduce((acc, header) => {\n      if (header.key && header.filter) {\n        acc[header.key] = header.filter\n      }\n      return acc\n    }, {} as FilterKeyFunctions)\n  })\n\n  const data = { headers, columns, sortFunctions, filterFunctions }\n\n  provide(VDataTableHeadersSymbol, data)\n\n  return data\n}\n\nexport function useHeaders () {\n  const data = inject(VDataTableHeadersSymbol)\n\n  if (!data) throw new Error('Missing headers!')\n\n  return data\n}\n"],"mappings":"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"}