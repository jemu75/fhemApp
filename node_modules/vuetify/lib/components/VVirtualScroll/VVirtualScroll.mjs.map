{"version":3,"file":"VVirtualScroll.mjs","names":["VVirtualScrollItem","makeComponentProps","makeDimensionProps","useDimension","useToggleScope","makeVirtualProps","useVirtual","onMounted","onScopeDispose","toRef","convertToUnit","genericComponent","getCurrentInstance","getScrollParent","propsFactory","useRender","makeVVirtualScrollProps","items","type","Array","default","renderless","Boolean","VVirtualScroll","name","props","setup","_ref","slots","vm","dimensionStyles","containerRef","markerRef","handleScroll","handleScrollend","handleItemResize","scrollToIndex","paddingTop","paddingBottom","computedItems","handleListeners","add","arguments","length","undefined","method","value","document","documentElement","passive","vnode","el","children","map","item","_createVNode","index","height","slotProps","raw","_Fragment","class","style"],"sources":["../../../src/components/VVirtualScroll/VVirtualScroll.tsx"],"sourcesContent":["// Styles\nimport './VVirtualScroll.sass'\n\n// Components\nimport { VVirtualScrollItem } from './VVirtualScrollItem'\n\n// Composables\nimport { makeComponentProps } from '@/composables/component'\nimport { makeDimensionProps, useDimension } from '@/composables/dimensions'\nimport { useToggleScope } from '@/composables/toggleScope'\nimport { makeVirtualProps, useVirtual } from '@/composables/virtual'\n\n// Utilities\nimport { onMounted, onScopeDispose, toRef } from 'vue'\nimport {\n  convertToUnit,\n  genericComponent,\n  getCurrentInstance,\n  getScrollParent,\n  propsFactory,\n  useRender,\n} from '@/util'\n\n// Types\nimport type { PropType, Ref } from 'vue'\nimport type { GenericProps } from '@/util'\n\nexport interface VVirtualScrollSlot<T> {\n  item: T\n  index: number\n}\n\nexport const makeVVirtualScrollProps = propsFactory({\n  items: {\n    type: Array as PropType<readonly unknown[]>,\n    default: () => ([]),\n  },\n  renderless: Boolean,\n\n  ...makeVirtualProps(),\n  ...makeComponentProps(),\n  ...makeDimensionProps(),\n}, 'VVirtualScroll')\n\nexport const VVirtualScroll = genericComponent<new <T, Renderless extends boolean = false>(\n  props: {\n    items?: readonly T[]\n    renderless?: Renderless\n  },\n  slots: {\n    default: VVirtualScrollSlot<T> & (Renderless extends true ? {\n      itemRef: Ref<HTMLElement | undefined>\n    } : {})\n  }\n) => GenericProps<typeof props, typeof slots>>()({\n  name: 'VVirtualScroll',\n\n  props: makeVVirtualScrollProps(),\n\n  setup (props, { slots }) {\n    const vm = getCurrentInstance('VVirtualScroll')\n    const { dimensionStyles } = useDimension(props)\n    const {\n      containerRef,\n      markerRef,\n      handleScroll,\n      handleScrollend,\n      handleItemResize,\n      scrollToIndex,\n      paddingTop,\n      paddingBottom,\n      computedItems,\n    } = useVirtual(props, toRef(props, 'items'))\n\n    useToggleScope(() => props.renderless, () => {\n      function handleListeners (add = false) {\n        const method = add ? 'addEventListener' : 'removeEventListener'\n\n        if (containerRef.value === document.documentElement) {\n          document[method]('scroll', handleScroll, { passive: true })\n          document[method]('scrollend', handleScrollend)\n        } else {\n          containerRef.value?.[method]('scroll', handleScroll, { passive: true })\n          containerRef.value?.[method]('scrollend', handleScrollend)\n        }\n      }\n\n      onMounted(() => {\n        containerRef.value = getScrollParent(vm.vnode.el as HTMLElement, true)\n        handleListeners(true)\n      })\n      onScopeDispose(handleListeners)\n    })\n\n    useRender(() => {\n      const children = computedItems.value.map(item => (\n        <VVirtualScrollItem\n          key={ item.index }\n          renderless={ props.renderless }\n          onUpdate:height={ height => handleItemResize(item.index, height) }\n        >\n          { slotProps => slots.default?.({ item: item.raw, index: item.index, ...slotProps }) }\n        </VVirtualScrollItem>\n      ))\n\n      return props.renderless ? (\n        <>\n          <div ref={ markerRef } class=\"v-virtual-scroll__spacer\" style={{ paddingTop: convertToUnit(paddingTop.value) }} />\n          { children }\n          <div class=\"v-virtual-scroll__spacer\" style={{ paddingBottom: convertToUnit(paddingBottom.value) }} />\n        </>\n      ) : (\n        <div\n          ref={ containerRef }\n          class={[\n            'v-virtual-scroll',\n            props.class,\n          ]}\n          onScrollPassive={ handleScroll }\n          onScrollend={ handleScrollend }\n          style={[\n            dimensionStyles.value,\n            props.style,\n          ]}\n        >\n          <div\n            ref={ markerRef }\n            class=\"v-virtual-scroll__container\"\n            style={{\n              paddingTop: convertToUnit(paddingTop.value),\n              paddingBottom: convertToUnit(paddingBottom.value),\n            }}\n          >\n            { children }\n          </div>\n        </div>\n      )\n    })\n\n    return {\n      scrollToIndex,\n    }\n  },\n})\n\nexport type VVirtualScroll = InstanceType<typeof VVirtualScroll>\n"],"mappings":"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"}