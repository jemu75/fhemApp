"use strict";(self["webpackChunkfhemapp"]=self["webpackChunkfhemapp"]||[]).push([[795],{6620:function(t,e,s){s.r(e),s.d(e,{default:function(){return w}});var i=s(4562),a=s(4145),o=s(4886),n=s(266),l=s(1030),r=s(9223),h=s(4324),c=s(4568),p=s(9592),m=s(1713),d=s(3687),f=s(7823),u=s(7808),g=function(){var t=this,e=t._self._c;return t.item.Options.show?e(n.Z,{class:t.item.Options.setup.size||t.setup.size},[e(a.Z,{attrs:{dark:this.$vuetify.theme.dark,color:"secondary"}},[e(p.Z,{attrs:{height:"7",value:t.item.Options.status.level||t.status.level,color:t.item.Options.status.color||t.status.color,"background-color":"secondary darken-1"}}),e(o.EB,{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.name)+" "),e(d.Z),t.item.Options.status.isActive?e(i.Z,{attrs:{small:"",icon:""},on:{click:t.expand}},[e(h.Z,{attrs:{small:""}},[t._v(" "+t._s(t.maxIcon)+" ")])],1):t._e(),t.app.options.debugMode?e("jsonList",{attrs:{item:t.item}}):t._e()],1),e(r.Z),t.item.Options.status.isActive?t._e():e("div",[e(o.ZB,[e(m.Z,{attrs:{align:"center"}},[e(n.Z,{attrs:{align:"center"}},[e("div",{staticClass:"headline font-weight-bold"},[t._v(" "+t._s(t.item.Options.status.error)+" ")])])],1)],1),e(r.Z)],1),t.item.Options.status.isActive?e("div",[e(o.ZB,{staticClass:"pa-0"},[t.setup.expanded?e(m.Z,{staticClass:"ma-3",attrs:{align:"center"}},[e(n.Z,{attrs:{cols:"2",align:"left"}},[e(i.Z,{attrs:{icon:"",small:""},on:{click:function(e){return t.changeDate("prev")}}},[e(h.Z,[t._v("mdi-chevron-left")])],1)],1),e(n.Z,[e(c.Z,{attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"",left:"","max-width":"290px","min-width":"auto"},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:i}){return[e(u.Z,t._g(t._b({attrs:{readonly:"",label:t.$t("app.dates.range")},model:{value:t.datesLocale,callback:function(e){t.datesLocale=e},expression:"datesLocale"}},"v-text-field",i,!1),s))]}}],null,!1,333734726),model:{value:t.datePicker,callback:function(e){t.datePicker=e},expression:"datePicker"}},[e(l.Z,{attrs:{range:"",locale:t.app.options.lang,"no-title":""},model:{value:t.dates,callback:function(e){t.dates=e},expression:"dates"}})],1)],1),e(n.Z,{attrs:{cols:"2",align:"right"}},[e(i.Z,{attrs:{icon:""},on:{click:function(e){return t.changeDate("next")}}},[e(h.Z,[t._v("mdi-chevron-right")])],1)],1)],1):t._e(),e("apex-chart",{attrs:{options:t.chart.options,series:t.chart.series},on:{zoomed:t.afterZoom}})],1)],1):t._e(),e(r.Z),e(f.Z,{attrs:{color:"secondary darken-1"}},[e(h.Z,{staticClass:"ml-0",attrs:{color:t.item.Options.info.left1IconColor}},[t._v(" "+t._s(t.item.Options.info.left1Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.left1Text)+" ")]),e(h.Z,{staticClass:"ml-2",attrs:{color:t.item.Options.info.left2IconColor}},[t._v(" "+t._s(t.item.Options.info.left2Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.left2Text)+" ")]),e(d.Z),e(h.Z,{attrs:{color:t.item.Options.info.mid1IconColor}},[t._v(" "+t._s(t.item.Options.info.mid1Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.mid1Text)+" ")]),e(h.Z,{staticClass:"ml-2",attrs:{color:t.item.Options.info.mid2IconColor}},[t._v(" "+t._s(t.item.Options.info.mid2Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.mid2Text)+" ")]),e(d.Z),e(h.Z,{attrs:{color:t.item.Options.info.right1IconColor}},[t._v(" "+t._s(t.item.Options.info.right1Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.right1Text)+" ")]),e(h.Z,{staticClass:"ml-2 mr-0",attrs:{color:t.item.Options.info.right2IconColor}},[t._v(" "+t._s(t.item.Options.info.right2Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.right2Text)+" ")])],1)],1)],1):t._e()},x=[],v=s(2559),_={components:{jsonList:v.Z},props:{item:{type:Object,default:()=>({name:"chart2"})}},data:()=>({name:"chart2",maxIcon:"mdi-arrow-expand",app:{options:{debugMode:!1,lang:"de"}},status:{color:"success",level:0},setup:{expanded:!1,size:"col-12 col-sm-12 col-md-6 col-lg-4"},dates:[],datesLocale:"",datePicker:!1,from:"",to:"",fromLocale:"",toLocale:"",timeSteps:null,chart:{series:[],options:{theme:{mode:"dark"},chart:{height:"auto",type:"line",toolbar:{show:!1}},tooltip:{x:{format:"ddd dd.MM.yy HH:mm:ss"}},xaxis:{type:"datetime",labels:{datetimeUTC:!1}}}}}),watch:{item:{immediate:!0,deep:!0,handler(){}},dates(t){this.from=t[0]>t[1]?t[1]:t[0],this.to=t[0]>t[1]?t[0]:t[1],2==t.length&&(this.datePicker=!1,this.setLocaleDate(),this.loadChartData())}},created(){this.app.options=this.$fhem.app.options,Object.assign(this.setup,this.item.Options.setup),this.chart.options.theme.mode=this.$vuetify.theme.dark?"dark":"light",this.item.Options.chartOptions&&Object.assign(this.chart.options,this.item.Options.chartOptions),this.setup.expanded&&(this.setup.expanded=!1,this.expand()),this.daysAgo=this.$fhem.getEl(this.item,"Options","setup","daysAgo"),this.daysTo=this.$fhem.getEl(this.item,"Options","setup","daysTo"),"number"!=typeof this.daysAgo&&(this.daysAgo=6),"number"!=typeof this.daysTo&&(this.daysTo=0),this.from=this.$fhem.getDate(this.daysAgo),this.to=this.$fhem.getDate(this.daysTo),this.setLocaleDate(),this.loadChartData()},methods:{expand(){this.setup.expanded?(this.setup.size="col-12 col-sm-12 col-md-6 col-lg-4",this.setup.expanded=!1,this.maxIcon="mdi-arrow-expand",this.chart.options.chart.height="auto"):(this.setup.size="col-12",this.setup.expanded=!0,this.maxIcon="mdi-arrow-collapse",this.chart.options.chart.height=window.innerHeight>600?parseInt(window.innerHeight-320):"auto"),this.chart.options=Object.assign({},this.chart.options)},changeDate(t){if("rest"==t)this.from=this.$fhem.getDate(this.daysAgo),this.to=this.$fhem.getDate(this.daysTo);else{let e=new Date(this.from),s=new Date(this.to),i=Math.abs(s-e)+864e5,a=new Date(this.from),o=new Date(this.to);"prev"==t&&(i=-i),this.from=new Date(a.setMilliseconds(a.getMilliseconds()+i)).toISOString().split("T")[0],this.to=new Date(o.setMilliseconds(o.getMilliseconds()+i)).toISOString().split("T")[0],this.setLocaleDate()}this.loadChartData()},setLocaleDate(){this.fromLocale=new Date(this.from).toLocaleString(this.app.options.lang,{dateStyle:"medium"}),this.toLocale=new Date(this.to).toLocaleString(this.app.options.lang,{dateStyle:"medium"}),this.datesLocale=this.fromLocale+" - "+this.toLocale},afterZoom(t,{xaxis:e}){this.from=new Date(e.min).toISOString().split("T")[0],this.to=new Date(e.max).toISOString().split("T")[0],this.setLocaleDate(),this.loadChartData()},getTimeSteps(){let t=new Date(this.from),e=new Date(this.to+" 23:59:59"),s=Math.abs(e-t);return s/this.app.options.maxChartPoints},loadChartData(){this.fromPicker=!1,this.toPicker=!1,this.timeSteps=this.getTimeSteps(),this.$fhem.loading=!0;let t={deviceName:this.item.Name,from:this.from,to:this.to,defs:this.item.Options.chartSeries},e=[];this.readLogData(t).then((t=>{if(t.length>0)for(const s of t){let t={data:this.handleLogData(s.data,s.calcMode),name:s.name};if(s.type&&(t.type=s.type),s.format){let t=s.format.split(" "),e={labels:{formatter:e=>{let i="",a=/%n./.test(t[0])?s.format.substring(t[0].match(/%n./).index+3,t[0].match(/%n./).index+4):1,o=t[1]?t[1]:"";return e&&(i=e.toLocaleString(this.app.options.lang,{minimumFractionDigits:a,maximumFractionDigits:a})+o),i}}};this.chart.options.yaxis&&this.chart.options.yaxis[s.id]?this.chart.options.yaxis[s.id].labels=e.labels:("undefined"===typeof this.chart.options.yaxis&&(this.chart.options.yaxis=[]),this.chart.options.yaxis.push(e))}e.push(t)}})).finally((()=>{this.chart.options=Object.assign({},this.chart.options),this.chart.series=e,this.$fhem.loading=!1}))},setTimeStep(t,e,s){switch(e||t.setTime(t.getTime()-1e3),s){case"hour":t.setTime(t.getTime()+36e5);break;case"day":t.setDate(t.getDate()+1);break;case"week":t.setDate(t.getDate()+7);break;case"month":t.setMonth(t.getMonth()+1);break;default:while(t<e)t.setMilliseconds(t.getMilliseconds()+this.timeSteps)}return t},handleLogData(t,e){let s=[],i=null,a=null,o=null,n=1,l=e?e.split("-")[0]:null,r=e?e.split("-")[1]:null,h=this.setTimeStep(new Date(this.from+"T00:00:00"),null,r),c=t.split("\n");c.length>3&&c.splice(-3,3),"raw"==l&&c.length>window.innerWidth&&(l=null);for(const[p,m]of c.entries()){let t=m.split(" "),e=new Date(t[0].replace("_","T")),d=parseFloat(t[1]);if("raw"==l)d==a&&c.length!=p+1||s.push([Date.parse(e),d]),a=d;else if(e<h&&p+1<c.length)switch(l){case"min":(d<i||!i)&&(i=d);break;case"max":(d>i||!i)&&(i=d);break;case"delta":o||(o=d);break;default:i&&n++,i+=d}else"delta"==l&&o&&(i=d-o),i||"delta"==l||(i=d),l&&"avg"!=l||(i/=n),i&&s.push([Date.parse(h),i]),h=this.setTimeStep(h,e,r),a=i,i=null,o=null,n=1}return s},async readLogData(t){let e=[];if(t.defs&&t.defs.length>0)for(const[s,i]of t.defs.entries()){let a=/\(.*\)/.exec(i),o=a?i.replace(a[0],"_").split(":"):i.split(":"),n="get ";n+=o[0]?o[0]:t.deviceName,n+=t.from?" - - "+t.from:"",n+=t.to?" "+t.to:"",n+=a?" "+a[0].replace(/\(|\)/g,""):" 4:"+o[1];let l=await this.$fhem.request([{param:"cmd",value:n},{param:"XHR",value:"1"}],"text",{id:s});l&&e.push({id:l.id,data:await l.data,name:o[2]||o[1],format:o[3],type:o[4],calcMode:o[5]})}return e}}},O=_,y=s(1001),D=(0,y.Z)(O,g,x,!1,null,null,null),w=D.exports}}]);